<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>{% block title %}Medicine Inventory{% endblock %}</title>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">

  <style>
    :root{
      --bg: #f5f8fb;
      --surface: #ffffff;
      --primary: #0b74ff;
      --accent: #00b4d8;
      --muted: #6c757d;
      --danger: #dc3545;
      --radius: 12px;
      --card-shadow: 0 8px 28px rgba(11,116,255,0.06);
      --max-width: 1200px;
      --gutter: 26px;
    }

    html,body { height:100%; }
    body{
      margin:0;
      background: linear-gradient(180deg,var(--bg), #eef6ff 60%);
      font-family: Inter, "Segoe UI", Roboto, system-ui, -apple-system, "Helvetica Neue", Arial;
      -webkit-font-smoothing:antialiased;
      color:#111;
      min-height:100vh;
      display:flex;
      flex-direction:column;
    }

    .navbar {
      background: linear-gradient(90deg,var(--primary), var(--accent));
      box-shadow: 0 6px 24px rgba(11,116,255,0.08);
      padding: 10px 18px;
    }
    .navbar-brand { color:#fff !important; font-weight:700; font-size:1.05rem; }
    .nav-actions .btn { border-radius:10px; }

    .app-container { max-width: var(--max-width); margin: 30px auto; width: calc(100% - 2 * var(--gutter)); padding: 0 10px; }

    .card { border: none; border-radius: var(--radius); background: var(--surface); box-shadow: var(--card-shadow); }
    .card .card-header { border-bottom: 0; background: transparent; padding: 18px 20px; }

    h1.app-title { color: var(--primary); font-size:40px; margin: 18px 0 20px 0; font-weight:700; }

    input.form-control, select.form-control, textarea.form-control {
      border-radius: 10px;
      border: 1px solid rgba(16,24,40,0.08);
      padding: 10px 12px;
      box-shadow: none;
    }
    .btn-primary {
      background: var(--primary);
      border: none;
      box-shadow: 0 10px 28px rgba(11,116,255,0.12);
      transition: transform .12s ease, box-shadow .12s ease;
      border-radius: 10px;
    }
    .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 14px 36px rgba(11,116,255,0.14); }

    /* Table */
    .table thead th { background: #1f2a44; color: #fff; border: none; font-weight:700; }
    .table tbody tr { transition: background .12s ease, transform .08s ease; }
    .table tbody tr:hover { background: #fbfdff; transform: translateY(-1px); }

    .badge-low { background: #ff6b6b; color: #fff; padding: 6px 10px; border-radius: 12px; }
    .badge-exp { background: #ffbf47; color: #222; padding: 6px 10px; border-radius: 12px; }

    .chatbox { padding: 20px; border-radius: var(--radius); }
    .chat-messages { background: #fbfdff; padding: 14px; border-radius: 8px; min-height: 120px; white-space: pre-line; }

    .fade-in { animation: fadeInUp .38s ease both; }
    @keyframes fadeInUp { from{opacity:0; transform:translateY(8px)} to{opacity:1; transform:none} }

    .dashboard-btn { display:none; }

    #globalLoader { display:none; position: fixed; left:0; top:0; right:0; bottom:0; z-index:2000; align-items:center; justify-content:center; background: rgba(8,12,20,0.25); }
    #globalLoader .spinner { width:88px; height:88px; border-radius:12px; background:var(--surface); display:flex; align-items:center; justify-content:center; box-shadow: var(--card-shadow); }
    .dot { width:10px; height:10px; background:var(--primary); border-radius:50%; margin:0 4px; animation:bounce .9s infinite ease-in-out; }
    .dot:nth-child(2){ animation-delay:.12s } .dot:nth-child(3){ animation-delay:.24s }
    @keyframes bounce { 0%,100%{ transform:translateY(0) } 50%{ transform:translateY(-8px) } }

    .muted { color: var(--muted); font-size: .95rem; }
    .small-gap { gap:10px; }
    @media (max-width: 1000px) {
      .app-container { max-width: 920px; }
      h1.app-title { font-size: 32px; }
    }
  </style>

  {% block extra_head %}{% endblock %}
</head>
<body>

  <!-- NAVBAR -->
  <nav class="navbar navbar-expand-lg navbar-dark">
    <div class="container">
      <a class="navbar-brand" href="{% url 'medicine_list' %}">ðŸ’Š MedAI Inventory</a>

      <div class="ms-auto nav-actions d-flex align-items-center small-gap">
        {% if user.is_authenticated %}
          <a href="{% url 'dashboard' %}" class="btn btn-light btn-sm me-2">
            <i class="bi bi-graph-up"></i> Dashboard
          </a>
          <a href="{% url 'medicine_add' %}" class="btn btn-light btn-sm me-2">
            <i class="bi bi-plus-circle"></i> Add Medicine
          </a>
          <a href="/api/medicines/" target="_blank" class="btn btn-outline-light btn-sm me-2">
            <i class="bi bi-code-slash"></i> API
          </a>
          <form method="post" action="{% url 'logout' %}" class="logout-form">
            {% csrf_token %}
            <button type="submit" class="btn btn-outline-light btn-sm">
              <i class="bi bi-box-arrow-right"></i> Logout
            </button>
          </form>
        {% else %}
          <a href="{% url 'login' %}" class="btn btn-light btn-sm">Login</a>
        {% endif %}
      </div>
    </div>
  </nav>

  <!-- MAIN -->
  <main class="app-container fade-in">
    {% block content %}{% endblock %}
  </main>

  <div id="globalLoader" role="status" aria-hidden="true">
    <div class="spinner" aria-hidden="true">
      <div style="display:flex; align-items:center;">
        <div class="dot"></div><div class="dot"></div><div class="dot"></div>
      </div>
    </div>
  </div>

  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

  <script>
    function showGlobalLoader(show=true){
      const el = document.getElementById('globalLoader');
      if(!el) return;
      el.style.display = show ? 'flex' : 'none';
      el.setAttribute('aria-hidden', show ? 'false' : 'true');
    }

    function setFormState(formEl, disabled){
      if(!formEl) return;
      Array.from(formEl.querySelectorAll('input,button,select,textarea')).forEach(i=>{
        if(i.type !== 'hidden'){ i.disabled = disabled; }
      });
    }
  </script>

  {% block extra_scripts %}{% endblock %}
</body>
</html>
